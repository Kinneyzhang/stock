#+TITLE: Stock.el ç”¨æˆ·ä½¿ç”¨æŒ‡å—
#+AUTHOR: Kinney Zhang
#+DATE: 2025
#+OPTIONS: toc:2 num:nil

* ç®€ä»‹

Stock.el æ˜¯ä¸€ä¸ªåŸºäºæ–°æµªè´¢ç» API çš„ Emacs æ’ä»¶ï¼Œç”¨äºå®æ—¶æ˜¾ç¤º A è‚¡ï¼ˆä¸­å›½è‚¡å¸‚ï¼‰æ•°æ®ã€‚

** ä¸»è¦åŠŸèƒ½

- ğŸ“Š *è‚¡ç¥¨çœ‹æ¿*ï¼šæ˜¾ç¤ºæŒ‡æ•°å’Œè‡ªé€‰è‚¡çš„å®æ—¶è¡Œæƒ…
- ğŸ“ˆ *æ¨¡å¼æ æ˜¾ç¤º*ï¼šåœ¨ Emacs æ¨¡å¼æ ç›´æ¥æŸ¥çœ‹è‚¡ä»·å˜åŠ¨
- ğŸ“‰ *æ ‡é¢˜æ æ˜¾ç¤º*ï¼šåœ¨ Emacs æ ‡é¢˜æ æ˜¾ç¤ºè‚¡ä»·
- ğŸ”„ *è‡ªåŠ¨åˆ·æ–°*ï¼šäº¤æ˜“æ—¶æ®µè‡ªåŠ¨åˆ·æ–°æ•°æ®
- ğŸ” *è‚¡ç¥¨æœç´¢*ï¼šæŒ‰ä»£ç æœç´¢ä»»æ„è‚¡ç¥¨
- â­ *è‡ªé€‰ç®¡ç†*ï¼šæ·»åŠ ã€åˆ é™¤è‡ªé€‰è‚¡ç¥¨

** æˆªå›¾

[[../imgs/stock.png]]

* å®‰è£…

** æ‰‹åŠ¨å®‰è£…

1. ä¸‹è½½ =stock.el= å’Œ =stock-utils.el= åˆ° Emacs åŠ è½½è·¯å¾„ä¸­
2. åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š

#+begin_src emacs-lisp
(add-to-list 'load-path "~/.emacs.d/site-lisp/stock")
(require 'stock)
#+end_src

** ä½¿ç”¨ use-package

#+begin_src emacs-lisp
(use-package stock
  :load-path "~/.emacs.d/site-lisp/stock"
  :bind
  ("C-c s s" . stock)
  ("C-c s m" . stock-modeline-mode)
  ("C-c s h" . stock-headerline-mode)
  :custom
  (stock-auto-refresh t)
  (stock-refresh-seconds 5)
  (stock-code-list '("sh600036" "sz000625")))
#+end_src

* å¿«é€Ÿå…¥é—¨

** æ‰“å¼€è‚¡ç¥¨çœ‹æ¿

#+begin_src text
M-x stock
#+end_src

æ‰§è¡Œåä¼šæ‰“å¼€ä¸€ä¸ªåä¸º =*A Chive*= çš„ç¼“å†²åŒºï¼Œæ˜¾ç¤ºï¼š
- é»˜è®¤çš„ä¸‰å¤§æŒ‡æ•°ï¼ˆä¸Šè¯ã€æ·±è¯ã€åˆ›ä¸šæ¿ï¼‰
- ä½ çš„è‡ªé€‰è‚¡åˆ—è¡¨

** è‚¡ç¥¨ä»£ç æ ¼å¼

è‚¡ç¥¨ä»£ç æ ¼å¼ä¸º =äº¤æ˜“æ‰€å‰ç¼€ + 6ä½ä»£ç =ï¼š

| å‰ç¼€ | äº¤æ˜“æ‰€   | ç¤ºä¾‹       | è¯´æ˜         |
|------+----------+------------+--------------|
| sh   | ä¸Šæµ·è¯åˆ¸ | sh600036   | æ‹›å•†é“¶è¡Œ     |
| sz   | æ·±åœ³è¯åˆ¸ | sz000625   | é•¿å®‰æ±½è½¦     |
| sh   | ä¸Šè¯æŒ‡æ•° | sh000001   | ä¸Šè¯ç»¼åˆæŒ‡æ•° |
| sz   | æ·±è¯æŒ‡æ•° | sz399001   | æ·±è¯æˆæŒ‡     |
| sz   | åˆ›ä¸šæ¿   | sz399006   | åˆ›ä¸šæ¿æŒ‡     |

* å‘½ä»¤è¯¦è§£

** ä¸»ç•Œé¢å‘½ä»¤

| å‘½ä»¤                     | å¿«æ·é”® | è¯´æ˜                                 |
|--------------------------+--------+--------------------------------------|
| =stock=                  | -      | æ‰“å¼€è‚¡ç¥¨çœ‹æ¿                         |
| =stock-refresh=          | =g=    | æ‰‹åŠ¨åˆ·æ–°æ•°æ®                         |
| =stock-search=           | =s=    | æœç´¢è‚¡ç¥¨                             |
| =stock-add=              | =+=    | æ·»åŠ è‡ªé€‰è‚¡                           |
| =stock-remove=           | =_=    | åˆ é™¤è‡ªé€‰è‚¡                           |
| =stock-switch-colouring= | =c=    | åˆ‡æ¢é¢œè‰²æ˜¾ç¤ºï¼ˆéšè”½æ¨¡å¼ï¼‰             |

** æ¨¡å¼æ å‘½ä»¤

| å‘½ä»¤                   | è¯´æ˜                         |
|------------------------+------------------------------|
| =stock-modeline-mode=  | å¼€å¯/å…³é—­æ¨¡å¼æ è‚¡ç¥¨æ˜¾ç¤º      |
| =stock-modeline-add=   | æ·»åŠ è‚¡ç¥¨åˆ°æ¨¡å¼æ              |
| =stock-modeline-remove= | ä»æ¨¡å¼æ åˆ é™¤è‚¡ç¥¨             |

** æ ‡é¢˜æ å‘½ä»¤

| å‘½ä»¤                     | è¯´æ˜                         |
|--------------------------+------------------------------|
| =stock-headerline-mode=  | å¼€å¯/å…³é—­æ ‡é¢˜æ è‚¡ç¥¨æ˜¾ç¤º      |
| =stock-headerline-add=   | æ·»åŠ è‚¡ç¥¨åˆ°æ ‡é¢˜æ              |
| =stock-headerline-remove= | ä»æ ‡é¢˜æ åˆ é™¤è‚¡ç¥¨             |

* ä½¿ç”¨åœºæ™¯

** åœºæ™¯ä¸€ï¼šæ—¥å¸¸çœ‹ç›˜

1. æ‰§è¡Œ =M-x stock= æ‰“å¼€çœ‹æ¿
2. æŒ‰ =+= æ·»åŠ è‡ªé€‰è‚¡
3. è¾“å…¥è‚¡ç¥¨ä»£ç ï¼ˆå¯ç©ºæ ¼åˆ†éš”è¾“å…¥å¤šä¸ªï¼‰

#+begin_src text
sh600036 sz000625 sz002050
#+end_src

4. çœ‹æ¿ä¼šè‡ªåŠ¨åˆ·æ–°ï¼ˆäº¤æ˜“æ—¶æ®µå†…ï¼‰

** åœºæ™¯äºŒï¼šæ¨¡å¼æ å¿«é€ŸæŸ¥çœ‹

ä¸æƒ³æ‰“å¼€ä¸“é—¨çª—å£ï¼Œåªæƒ³åœ¨å·¥ä½œæ—¶ä½™å…‰çœ‹ä¸€çœ¼è‚¡ä»·ï¼š

#+begin_src emacs-lisp
;; é…ç½®æ¨¡å¼æ æ˜¾ç¤ºçš„è‚¡ç¥¨
(setq stock-modeline-stocks '("sh600036" "sz000625"))

;; å¯ç”¨æ¨¡å¼æ æ˜¾ç¤º
(stock-modeline-mode 1)
#+end_src

æ¨¡å¼æ æ•ˆæœï¼š=[æ‹›å•†é“¶è¡Œ:+1.23%] [é•¿å®‰æ±½è½¦:-0.45%]=

** åœºæ™¯ä¸‰ï¼šéšè”½æ¨¡å¼

ä¸Šç­æ—¶é—´éœ€è¦ä½è°ƒæŸ¥çœ‹ï¼š

1. åœ¨çœ‹æ¿ä¸­æŒ‰ =c= åˆ‡æ¢åˆ°æ— é¢œè‰²æ¨¡å¼
2. æ‰€æœ‰æ¶¨è·Œé¢œè‰²å˜ä¸ºç°è‰²
3. å†æŒ‰ =c= æ¢å¤é¢œè‰²

** åœºæ™¯å››ï¼šå¿«é€Ÿæœç´¢

æƒ³æŸ¥çœ‹æŸåªè‚¡ç¥¨ä½†ä¸æƒ³åŠ å…¥è‡ªé€‰ï¼š

#+begin_src text
M-x stock-search
Enter stock codes to search: sh601398 sh601288
#+end_src

ä¼šæ‰“å¼€å•ç‹¬çš„æœç´¢ç»“æœçª—å£ã€‚

* é…ç½®é€‰é¡¹

| å˜é‡                            | é»˜è®¤å€¼                                 | è¯´æ˜                       |
|---------------------------------+----------------------------------------+----------------------------|
| =stock-index-list=              | '("sh000001" "sz399001" "sz399006")    | æ˜¾ç¤ºçš„æŒ‡æ•°åˆ—è¡¨             |
| =stock-code-list=               | '("sh600036" "sz000625")               | é»˜è®¤è‡ªé€‰è‚¡åˆ—è¡¨             |
| =stock-buffer-name=             | "*A Chive*"                            | ä¸»çœ‹æ¿ç¼“å†²åŒºåç§°           |
| =stock-auto-refresh=            | t                                      | æ˜¯å¦è‡ªåŠ¨åˆ·æ–°               |
| =stock-refresh-seconds=         | 5                                      | åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰             |
| =stock-cache-path=              | ~/.emacs.d/.stock                      | è‡ªé€‰è‚¡ç¼“å­˜æ–‡ä»¶è·¯å¾„         |
| =stock-colouring=               | t                                      | æ˜¯å¦å¯ç”¨é¢œè‰²               |
| =stock-modeline-format=         | "[%n:%p]"                              | æ¨¡å¼æ æ˜¾ç¤ºæ ¼å¼             |
| =stock-modeline-refresh-seconds= | 1                                      | æ¨¡å¼æ åˆ·æ–°é—´éš”             |
| =stock-headerline-format=       | "[%n:%p]"                              | æ ‡é¢˜æ æ˜¾ç¤ºæ ¼å¼             |

** æ ¼å¼å­—ç¬¦ä¸²

æ¨¡å¼æ å’Œæ ‡é¢˜æ æ ¼å¼æ”¯æŒä»¥ä¸‹å ä½ç¬¦ï¼š

| å ä½ç¬¦ | å«ä¹‰     | ç¤ºä¾‹      |
|--------+----------+-----------|
| =%n=   | è‚¡ç¥¨åç§° | æ‹›å•†é“¶è¡Œ  |
| =%p=   | æ¶¨è·Œå¹…   | +1.23%    |

è‡ªå®šä¹‰ç¤ºä¾‹ï¼š

#+begin_src emacs-lisp
;; åªæ˜¾ç¤ºæ¶¨è·Œå¹…
(setq stock-modeline-format "<%p>")

;; æ˜¾ç¤ºåç§°å’Œæ¶¨è·Œå¹…
(setq stock-modeline-format "%n %p")
#+end_src

* é¢œè‰²è¯´æ˜

| é¢œè‰² | å«ä¹‰     |
|------+----------|
| çº¢è‰² | ä¸Šæ¶¨     |
| ç»¿è‰² | ä¸‹è·Œ     |
| ç°è‰² | æŒå¹³     |

*æ³¨æ„*ï¼šé¢œè‰²éµå¾ªä¸­å›½è‚¡å¸‚æƒ¯ä¾‹ï¼ˆçº¢æ¶¨ç»¿è·Œï¼‰ï¼Œä¸æ¬§ç¾å¸‚åœºç›¸åã€‚

* å¸¸è§é—®é¢˜

** Q: ä¸ºä»€ä¹ˆæ•°æ®ä¸æ›´æ–°ï¼Ÿ

A: è¯·æ£€æŸ¥ï¼š
1. æ˜¯å¦åœ¨äº¤æ˜“æ—¶æ®µï¼ˆå·¥ä½œæ—¥ 9:00-11:30, 13:00-15:00ï¼‰
2. ç½‘ç»œæ˜¯å¦æ­£å¸¸
3. =stock-auto-refresh= æ˜¯å¦ä¸º =t=

** Q: å¦‚ä½•æ‰¾åˆ°è‚¡ç¥¨ä»£ç ï¼Ÿ

A: è‚¡ç¥¨ä»£ç æ ¼å¼ï¼š
- ä¸Šæµ·è‚¡ç¥¨ï¼š=sh= + 6ä½ä»£ç ï¼ˆå¦‚ =sh600036=ï¼‰
- æ·±åœ³è‚¡ç¥¨ï¼š=sz= + 6ä½ä»£ç ï¼ˆå¦‚ =sz000625=ï¼‰

å¯åœ¨ä»»ä½•è´¢ç»ç½‘ç«™æŸ¥è¯¢è‚¡ç¥¨ä»£ç ã€‚

** Q: å¦‚ä½•å®Œå…¨å…³é—­æ¨¡å¼æ /æ ‡é¢˜æ æ˜¾ç¤ºï¼Ÿ

#+begin_src emacs-lisp
(stock-modeline-mode -1)
(stock-headerline-mode -1)
#+end_src

** Q: è‡ªé€‰è‚¡ä¿å­˜åœ¨å“ªé‡Œï¼Ÿ

é»˜è®¤ä¿å­˜åœ¨ =~/.emacs.d/.stock= æ–‡ä»¶ä¸­ï¼Œå¯é€šè¿‡ =stock-cache-path= å˜é‡ä¿®æ”¹ã€‚

* è‡´è°¢

- åŸä½œè€…ï¼šzakudriver (https://github.com/zakudriver/achive)
- æ–°æµªè´¢ç»æä¾›çš„é«˜é€Ÿ API

* è®¸å¯è¯

æœ¬è½¯ä»¶é‡‡ç”¨ [[http://www.gnu.org/licenses/][GNU General Public License v3.0]] è®¸å¯ã€‚
